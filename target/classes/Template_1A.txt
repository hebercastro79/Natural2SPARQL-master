# Template_1A.txt (Final Corrected Version - 2025-04-23)
# Busca Preço de Fechamento por Ticker e Data
SELECT DISTINCT ?precoFechamento
WHERE {
  # Navega da empresa para a instância de negociação específica
  ?empresa <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#temValorMobiliarioNegociado> ?valor_mobiliario  .
  ?valor_mobiliario <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#representadoPor> ?codigo .
  ?codigo <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#ticker> ?ticker_literal . # Obtém o ticker literal
  ?valor_mobiliario <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#negociado> ?negociado .
  ?negociado <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#negociadoDurante> ?pregao .

  # Obtém o preço de fechamento
  ?negociado <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#precoFechamento> ?precoFechamento .

  # Filtra pela data exata (Java substitui #DATA# por "YYYY-MM-DD"^^xsd:date)
  ?pregao <https://dcm.ffclrp.usp.br/lssb/stock-market-ontology#ocorreEmData> #DATA# .

  # Filtra pelo ticker (Java substitui #ENTIDADE_NOME# por "TICKER_OU_LISTA")
  FILTER CONTAINS(lcase(#ENTIDADE_NOME#), lcase(str(?ticker_literal))) .
}
LIMIT 10 # Boa prática